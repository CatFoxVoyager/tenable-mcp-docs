# AGENTS.md

This document helps future agents work effectively in this repository.

## Project Overview

**tenable-docs-mcp** is a Model Context Protocol (MCP) server for retrieving Tenable documentation. It serves as an interface between an LLM and the Tenable Developer documentation site (https://developer.tenable.com/).

**Purpose**: Enable AI assistants to retrieve and process technical documentation to help users generate scripts and understand Tenable APIs.

**IMPORTANT**: This server is for documentation retrieval ONLY. It does NOT manage API keys, authenticate to Tenable APIs, or access account data.

## Tech Stack

- **Language**: TypeScript
- **Runtime**: Node.js 18+
- **Framework**: @modelcontextprotocol/sdk
- **Dependencies**:
  - axios: HTTP requests
  - cheerio: HTML parsing/cleaning
  - turndown: HTML to Markdown conversion

## Build and Development Commands

```bash
# Install dependencies
npm install

# Build TypeScript to JavaScript
npm run build

# Start the MCP server
npm start

# Build and start in one command
npm run dev

# Watch mode for development
npm run watch
```

## Project Structure

```
tenable-mcp-docs/
├── src/
│   ├── index.ts           # Main MCP server entry point
│   ├── tools/
│   │   ├── search.ts      # Search tool implementation
│   │   └── read.ts        # Read page tool implementation
│   ├── utils/
│   │   ├── scraper.ts     # HTML scraping, cleaning utilities
│   │   └── converter.ts   # HTML to Markdown conversion
│   └── types.ts           # All TypeScript type definitions
├── dist/                  # Compiled JavaScript (generated by build)
├── package.json
├── tsconfig.json
├── README.md
└── AGENTS.md
```

## Key Concepts

### MCP Tools

The server exposes two MCP tools:

1. **search_docs**: Search Tenable documentation for relevant pages
   - Input: `query` (string) - Search terms
   - Output: Array of `{url, title, description}` objects

2. **read_page**: Download a page and convert to Markdown
   - Input: `url` (string) - Tenable documentation URL
   - Output: `{url, title, content, wordCount}` object

### Error Handling

Custom error classes in `src/types.ts`:
- `ValidationError`: Invalid input parameters
- `NetworkError`: HTTP request failures
- `ParseError`: HTML/JSON parsing failures
- `ScrapingError`: Content scraping/cleaning failures
- `ConversionError`: HTML to Markdown conversion failures
- `SearchError`: Search functionality failures

All tools return structured error responses with `code`, `message`, and `details`.

### Code Patterns

- **Type Safety**: Full TypeScript typing everywhere. Import types from `src/types.ts`
- **Async Functions**: All async functions use try-catch with proper error handling
- **Validation**: Input parameters validated before processing
- **URL Validation**: Only allows URLs from `developer.tenable.com` and `tenable.com`
- **Code Block Preservation**: Code blocks extracted before cleaning and restored after

## Important Gotchas

1. **Search is Simulated**: The search tool matches queries against known documentation patterns. It doesn't connect to Tenable's actual search API. This is intentional for the current implementation.

2. **Stdio Transport**: Server uses stdio transport for MCP communication. It's meant to be run as a subprocess by MCP clients like Claude Desktop.

3. **No Persistence**: The server doesn't cache results or store any data. Each request is independent.

4. **Domain Restriction**: The `read_page` tool only accepts URLs from Tenable documentation domains. This is a security measure.

5. **TypeScript Compilation**: Always run `npm run build` before testing. The server runs from `dist/index.js`, not the source files.

6. **Error Output**: Errors are sent to `stderr` (via `console.error`) for MCP protocol compliance. Startup messages only appear if `DEBUG` environment variable is set.

## Testing the Server

To test the server locally:

```bash
# Build the project
npm run build

# Start the server (it will wait for MCP protocol messages)
npm start
```

**Note**: The server uses stdio transport and doesn't provide an interactive console. It communicates via JSON messages over stdin/stdout as per MCP protocol.

To actually test the tools, you need an MCP client (like Claude Desktop) configured to use this server.

## Integration with Claude Desktop

Add to Claude Desktop config file:

**macOS**: `~/Library/Application Support/Claude/claude_desktop_config.json`
**Windows**: `%APPDATA%\Claude\claude_desktop_config.json`

```json
{
  "mcpServers": {
    "tenable-docs": {
      "command": "node",
      "args": ["D:/code/tenable-mcp-docs/dist/index.js"]
    }
  }
}
```

Replace the path with the actual path to `dist/index.js`.

## Dependencies and Versions

Check `package.json` for current versions:
- @modelcontextprotocol/sdk: ^1.0.4
- axios: ^1.7.9
- cheerio: ^1.0.0-rc.12
- turndown: ^7.2.0

## Code Quality Standards

- **TypeScript Strict Mode**: Enabled in `tsconfig.json`
- **ES2022 Target**: Modern JavaScript features
- **No Unused Variables**: TypeScript flags unused imports/variables
- **JSDoc Comments**: All public functions documented
- **Error First**: All async operations handle errors explicitly

## Troubleshooting Common Issues

### Build Fails with TypeScript Errors

Check for:
- Unused imports
- Type mismatches
- Missing type definitions

Run `npm run build` to see specific errors.

### Server Won't Start

Verify:
- Dependencies installed: `npm install`
- Project built: `npm run build`
- Node.js version: `node --version` (must be 18+)

### Tools Not Appearing in Claude Desktop

1. Verify path in config points to `dist/index.js` (NOT `src/index.ts`)
2. Restart Claude Desktop after config change
3. Check Claude Desktop logs for errors

## Security Considerations

- **URL Whitelisting**: Only Tenable documentation domains allowed
- **No Credential Storage**: Server doesn't handle API keys or secrets
- **Input Validation**: All inputs validated before processing
- **No Code Execution**: Server only reads and converts documentation

## Adding New Features

When adding new tools:

1. Add tool to `src/tools/` directory
2. Implement with TypeScript types from `src/types.ts`
3. Register tool in `src/index.ts` under `ListToolsRequestSchema` handler
4. Add tool handler in `CallToolRequestSchema` handler
5. Use proper error handling with custom error types
6. Test build with `npm run build`

## Documentation Files

- **README.md**: User-facing documentation (installation, usage, examples)
- **AGENTS.md**: This file - for AI agents working on this codebase
- **JSDoc comments**: Inline code documentation

## Testing

Currently, the project doesn't have automated tests. When adding tests:

1. Use a testing framework like Jest or Vitest
2. Test tool logic independently of MCP server
3. Mock HTTP requests for scraper tests
4. Mock HTML content for converter tests
5. Add test script to `package.json`

## Search Implementation Details

The search tool works by:
1. Normalizing the query (lowercase, trim, remove special chars)
2. Matching query words against known documentation patterns
3. Calculating relevance scores
4. Returning top matches by relevance

This is a simplified implementation. For production, consider integrating with Tenable's actual search API or implementing full-text search on documentation index.

## Code Block Preservation

The scraper preserves code blocks during HTML cleaning:

1. Extract all `<pre>` and `<code>` elements
2. Replace with placeholders (`__CODE_BLOCK_N__`)
3. Clean the rest of the HTML
4. Restore original code blocks from placeholders

This ensures code examples maintain their syntax and formatting.

## Markdown Conversion

The converter uses Turndown with custom rules:
- Code blocks with language specification
- Inline code
- Tables
- Links with titles
- Images
- Blockquotes
- Horizontal rules

All configured to produce clean, readable Markdown.
